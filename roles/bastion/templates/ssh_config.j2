Host webdev-*
    User {{ ansible_user }}
    IdentityFile /home/{{ ansible_user }}/.ssh/labsuser.pem
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null
    ServerAliveInterval 60
    TCPKeepAlive yes
    ForwardAgent yes
    Compression yes
    ControlMaster auto
    ControlPath ~/.ssh/control-%r@%h:%p
    ControlPersist 5m
    ConnectTimeout 60
    BatchMode yes

Host webdev-web
    HostName {{ hostvars[groups['tag_Role_Web'][0]].private_ip_address }}
    ProxyCommand ssh -W %h:%p {{ ansible_user }}@{{ hostvars[groups['tag_Role_Bastion'][0]].public_ip_address }}

Host webdev-db
    HostName {{ hostvars[groups['tag_Role_DB'][0]].private_ip_address }}
    ProxyCommand ssh -W %h:%p {{ ansible_user }}@{{ hostvars[groups['tag_Role_Bastion'][0]].public_ip_address }}

# Configuration globale
Host *
    ServerAliveInterval 60
    TCPKeepAlive yes
    ForwardAgent yes
    GSSAPIAuthentication no
    ConnectTimeout 30
    BatchMode yes
    PreferredAuthentications publickey
    AddKeysToAgent yes
    IdentitiesOnly yes
