Host *
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null
    ServerAliveInterval 30
    ControlMaster auto
    ControlPath /tmp/ansible-ssh-%h-%p-%r
    ControlPersist 15m
    ForwardAgent yes
    BatchMode yes
    ConnectTimeout 60
    TCPKeepAlive yes
    ServerAliveCountMax 6

Host webdev-*
    User {{ ansible_user }}
    IdentityFile {{ ansible_ssh_private_key_file }}
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null
    ForwardAgent yes

Host webdev-web
    HostName {{ hostvars[groups['tag_Role_Web'][0]].private_ip_address }}
    ProxyCommand ssh -W %h:%p -q {{ ansible_user }}@{{ hostvars[groups['tag_Role_Bastion'][0]].public_ip_address }}

Host webdev-db
    HostName {{ hostvars[groups['tag_Role_DB'][0]].private_ip_address }}
    ProxyCommand ssh -W %h:%p -q {{ ansible_user }}@{{ hostvars[groups['tag_Role_Bastion'][0]].public_ip_address }}

# Connexion directe aux serveurs par IP priv√©e
Host {{ hostvars[groups['tag_Role_Web'][0]].private_ip_address }}
    ProxyCommand ssh -W %h:%p -q {{ ansible_user }}@{{ hostvars[groups['tag_Role_Bastion'][0]].public_ip_address }}
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null
    ForwardAgent yes

Host {{ hostvars[groups['tag_Role_DB'][0]].private_ip_address }}
    ProxyCommand ssh -W %h:%p -q {{ ansible_user }}@{{ hostvars[groups['tag_Role_Bastion'][0]].public_ip_address }}
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null
    ForwardAgent yes

Host {{ hostvars[groups['tag_Role_Bastion'][0]].public_ip_address }}
    IdentityFile {{ ansible_ssh_private_key_file }}
    User {{ ansible_user }}
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null
    ForwardAgent yes
